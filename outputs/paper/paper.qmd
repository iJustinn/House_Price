---
title: "TBD"
subtitle: "TBD"
author: 
  - Ziheng Zhong
thanks: "Code and data are available at: https://github.com/iJustinn/House_Price.git"
date: today
date-format: long
abstract: "TBD"
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| message: false
#| echo: false

# load packages
packages <- c("tidyverse", "ggplot2", "janitor", "readr", "knitr", "modelsummary", "testthat", "kableExtra", "viridis", "lubridate", "maps", "mgcv")

# Function to check and install missing packages
install_and_load <- function(packages) {
  for (package in packages) {
    if (!require(package, character.only = TRUE)) {
      install.packages(package)
      library(package, character.only = TRUE)
    }
  }
}

# Call the function with the list of packages
install_and_load(packages)
```

```{r}
#| message: false
#| echo: false

# read in data
house_prices <- read_csv("../../outputs/data/merged_house_price.csv")

state_house_price_by_year <- read_csv("../../outputs/data/state_house_price_by_year.csv")
state_1b_house_price_by_year <- read_csv("../../outputs/data/state_1b_house_price_by_year.csv")
state_2b_house_price_by_year <- read_csv("../../outputs/data/state_2b_house_price_by_year.csv")
state_3b_house_price_by_year <- read_csv("../../outputs/data/state_3b_house_price_by_year.csv")
state_4b_house_price_by_year <- read_csv("../../outputs/data/state_4b_house_price_by_year.csv")
state_5bplus_house_price_by_year <- read_csv("../../outputs/data/state_5bplus_house_price_by_year.csv")

state_house_price_by_month <- read_csv("../../outputs/data/state_house_price_by_month.csv")
state_1b_house_price_by_month <- read_csv("../../outputs/data/state_1b_house_price_by_month.csv")
state_2b_house_price_by_month <- read_csv("../../outputs/data/state_2b_house_price_by_month.csv")
state_3b_house_price_by_month <- read_csv("../../outputs/data/state_3b_house_price_by_month.csv")
state_4b_house_price_by_month <- read_csv("../../outputs/data/state_4b_house_price_by_month.csv")
state_5bplus_house_price_by_month <- read_csv("../../outputs/data/state_5bplus_house_price_by_month.csv")

```

# Introduction



# Data {#sec-data}

Data used in this paper was cleaned, processed and tested with the programming language R [@citeR]. Also with support of additional packages in R: `tidyverse` [@citeTidyverse], `ggplot2` [@citeGgplot], `janitor` [@citeJanitor], `readr` [@citeReadr], `knitr` [@citeKnitr], `modelsummary` [@citeModelsummary], `testthat` [@citeTestthat], `KableExtra` [@citeKableEx], `viridis` [@citeViridis], `lubridate` [@citeLubridate], `maps` [@citeMaps], `mgcv` [@citeMgcv].

## Source



## Method

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: tbl-sum
#| tbl-cap: Summary statistics of the California housing dataset
#| layout-ncol: 3
#| layout-nrow: 3



```



```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: tbl-null-raw
#| tbl-cap: Count of missing values for each variable



```



```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: tbl-null-clean
#| tbl-cap: Count of missing values for each variable after cleaning



```



# Results {#sec-res}

```{r}
#| include: false
# Models Setup

#### Multiple Regression Model ####
model_multi <- lm(AvgHousePrice ~ Year + NumBedroom, data = house_prices)

#### Polynomial Regression Model ####
model_poly <- lm(AvgHousePrice ~ poly(Year, 2) + poly(NumBedroom, 2), data = house_prices)

#### Generalized Additive Models ####
num_unique_years <- length(unique(house_prices$Year))
num_unique_bedrooms <- length(unique(house_prices$NumBedroom))

gam_model <- gam(AvgHousePrice ~ s(Year, k=num_unique_years-1) + s(NumBedroom, k=num_unique_bedrooms-1), data = house_prices)

```

## Data Trend

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: fig-trend_overall
#| fig-cap: Trend of Average House Price from 2000 to 2024

state_all <- state_house_price_by_month %>% select(-StateName) %>%  # Processing datasets
  summarise_all(mean, na.rm = TRUE) %>%
  pivot_longer(everything(), names_to = "Date", values_to = "AverageHousePrice")

state_all$Date <- as.Date(state_all$Date) # Convert Date from character to Date type

ggplot(state_all, aes(x = Date, y = AverageHousePrice)) + # Plotting
  geom_line(color = "blue") + 
  labs(x = "Year", y = "Average House Price ($)") + 
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: fig-trend_by_type
#| fig-cap: Trend of Average House Price from 2000 to 2024 by House Type

process_data <- function(data, label) { # Function to process each dataset
  data %>% 
    select(-StateName) %>%
    summarise_all(mean, na.rm = TRUE) %>%
    pivot_longer(everything(), names_to = "Date", values_to = "AverageHousePrice") %>%
    mutate(Trend = label,
           Date = as.Date(Date))
}

data_list <- list( # Processing all datasets
  one_bedroom = state_1b_house_price_by_month,
  two_bedroom = state_2b_house_price_by_month,
  three_bedroom = state_3b_house_price_by_month,
  four_bedroom = state_4b_house_price_by_month,
  five_plus_bedroom = state_5bplus_house_price_by_month
)

processed_data <- lapply(names(data_list), function(name) process_data(data_list[[name]], name))

combined_data <- bind_rows(processed_data) # Combining all processed data into one dataframe

ggplot(combined_data, aes(x = Date, y = AverageHousePrice, color = Trend)) + # Plotting
  geom_line() + 
  labs(x = "Year", y = "Average House Price ($)") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_color_viridis_d(name = "House Type")

```

## Heat Maps

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: fig-hm_overall
#| fig-cap: Average Price by State in the US for All House Types

us_states_map <- map_data("state") # Getting map data for US states

state_abbrev_to_full <- c( # Define the mapping from state abbreviations to full names
  AL = "alabama", AK = "alaska", AZ = "arizona", AR = "arkansas", CA = "california",
  CO = "colorado", CT = "connecticut", DE = "delaware", FL = "florida", GA = "georgia",
  HI = "hawaii", ID = "idaho", IL = "illinois", IN = "indiana", IA = "iowa",
  KS = "kansas", KY = "kentucky", LA = "louisiana", ME = "maine", MD = "maryland",
  MA = "massachusetts", MI = "michigan", MN = "minnesota", MS = "mississippi",
  MO = "missouri", MT = "montana", NE = "nebraska", NV = "nevada", NH = "new hampshire",
  NJ = "new jersey", NM = "new mexico", NY = "new york", NC = "north carolina",
  ND = "north dakota", OH = "ohio", OK = "oklahoma", OR = "oregon", PA = "pennsylvania",
  RI = "rhode island", SC = "south carolina", SD = "south dakota", TN = "tennessee",
  TX = "texas", UT = "utah", VT = "vermont", VA = "virginia", WA = "washington",
  WV = "west virginia", WI = "wisconsin", WY = "wyoming", DC = "district of columbia"
)

overall_hm_data <- na.omit(state_house_price_by_year) # Delete all NAs
overall_hm_data$StateName <- tolower(state_abbrev_to_full[overall_hm_data$StateName]) # Convert StateName from abbreviation to full name

overall_hm_data <- overall_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

overall_hm_map_merged_data <- merge(us_states_map, overall_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = overall_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")

```

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: fig-hm_by_type
#| fig-cap: Average Price by State in the US for Different House Types
#| fig-subcap: ["one bedroom","two bedrooms","three bedrooms","four bedrooms","five plus bedrooms"]
#| layout-ncol: 2
#| layout-nrow: 3

us_states_map <- map_data("state") # Getting map data for US states

state_abbrev_to_full <- c( # Define the mapping from state abbreviations to full names
  AL = "alabama", AK = "alaska", AZ = "arizona", AR = "arkansas", CA = "california",
  CO = "colorado", CT = "connecticut", DE = "delaware", FL = "florida", GA = "georgia",
  HI = "hawaii", ID = "idaho", IL = "illinois", IN = "indiana", IA = "iowa",
  KS = "kansas", KY = "kentucky", LA = "louisiana", ME = "maine", MD = "maryland",
  MA = "massachusetts", MI = "michigan", MN = "minnesota", MS = "mississippi",
  MO = "missouri", MT = "montana", NE = "nebraska", NV = "nevada", NH = "new hampshire",
  NJ = "new jersey", NM = "new mexico", NY = "new york", NC = "north carolina",
  ND = "north dakota", OH = "ohio", OK = "oklahoma", OR = "oregon", PA = "pennsylvania",
  RI = "rhode island", SC = "south carolina", SD = "south dakota", TN = "tennessee",
  TX = "texas", UT = "utah", VT = "vermont", VA = "virginia", WA = "washington",
  WV = "west virginia", WI = "wisconsin", WY = "wyoming", DC = "district of columbia"
)

#### US States 1b House Price Heat Map ####
oneb_hm_data <- na.omit(state_1b_house_price_by_year) # Delete all NAs
oneb_hm_data$StateName <- tolower(state_abbrev_to_full[oneb_hm_data$StateName]) # Convert StateName from abbreviation to full name

oneb_hm_data <- oneb_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

oneb_hm_map_merged_data <- merge(us_states_map, oneb_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = oneb_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")



#### US States 2b House Price Heat Map ####
twob_hm_data <- na.omit(state_2b_house_price_by_year) # Delete all NAs
twob_hm_data$StateName <- tolower(state_abbrev_to_full[twob_hm_data$StateName]) # Convert StateName from abbreviation to full name

twob_hm_data <- twob_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

twob_hm_map_merged_data <- merge(us_states_map, twob_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = twob_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")



#### US States 3b House Price Heat Map ####
threeb_hm_data <- na.omit(state_3b_house_price_by_year) # Delete all NAs
threeb_hm_data$StateName <- tolower(state_abbrev_to_full[threeb_hm_data$StateName]) # Convert StateName from abbreviation to full name

threeb_hm_data <- threeb_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

threeb_hm_map_merged_data <- merge(us_states_map, threeb_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = threeb_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")



#### US States 4b House Price Heat Map ####
fourb_hm_data <- na.omit(state_4b_house_price_by_year) # Delete all NAs
fourb_hm_data$StateName <- tolower(state_abbrev_to_full[fourb_hm_data$StateName]) # Convert StateName from abbreviation to full name

fourb_hm_data <- fourb_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

fourb_hm_map_merged_data <- merge(us_states_map, fourb_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = fourb_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")



#### US States 5b+ House Price Heat Map ####
fiveb_hm_data <- na.omit(state_5bplus_house_price_by_year) # Delete all NAs
fiveb_hm_data$StateName <- tolower(state_abbrev_to_full[fiveb_hm_data$StateName]) # Convert StateName from abbreviation to full name

fiveb_hm_data <- fiveb_hm_data %>% # Taking average for house price based on states
  group_by(StateName) %>%
  summarise(AvgHousePrice = mean(AvgHousePrice, na.rm = TRUE))

fiveb_hm_map_merged_data <- merge(us_states_map, fiveb_hm_data, by.x = "region", by.y = "StateName") # Merge data ready for chart

ggplot() + # Generating heat map
  geom_polygon(data = fiveb_hm_map_merged_data, aes(x = long, y = lat, group = group, fill = AvgHousePrice), color = "white") +
  coord_fixed(1.3) +
  scale_fill_viridis(name = "Avg House Price", option = "plasma") +
  theme_minimal() +
  theme(legend.position = "right")

```



## Modeling

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: tbl-linear_model_result
#| tbl-cap: Modeling Results for Linear Models

modelsummary(
  list(
    "Multiple Regression" = model_multi,
    "Polynomial Regression" = model_poly
  )
)

```



```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: tbl-nonlinear_model_result
#| fig-cap: Modeling Results for Non-linear Models

modelsummary(
  list(
    "GAM Regression" = gam_model
  )
)

```



```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-pos: 'h'
#| label: fig-GAM
#| tbl-cap: GAM Regression Fit Result

plot(gam_model, pages=1)

```

# Discussion {#sec-dis}



## Demographic Shifts



## Health-related Behaviors



## Government Policies



## Environmental Changes



## Possible Improvements



# Conclusion {#sec-con}



\newpage

\appendix

# Appendix

## Datasheet

**Motivation**

**Composition**

**Collection process**

**Preprocessing/cleaning/labeling**

**Uses**

**Distribution**

**Maintenance**



\newpage


# References


